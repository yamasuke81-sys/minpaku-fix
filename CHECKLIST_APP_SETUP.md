# 清掃チェックリストWebアプリ セットアップガイド

## 📱 概要

軽量・スマホ最適化された清掃チェックリスト専用Webアプリです。
予約管理アプリから分離することで、スタッフが現場で高速に利用できます。

## 🎯 主な機能

### 1. 次回予約詳細の自動表示
- チェックリスト冒頭に次回予約情報を表示
- チェックアウト日をキーに取得（行番号に依存しない）
- チェックイン日、宿泊者名、人数、BBQ利用などを表示

### 2. 要補充機能
- 各チェック項目に「要補充」チェックボックス
- 要補充項目を画面上部に一覧表示
- 清掃完了時にオーナーに要補充リストを自動送信

### 3. 部屋ごとの折りたたみ表示
- 駐車場、テラス、キッチンなど場所ごとにセクション化
- 各セクションをタップで折りたたみ/展開
- セクションごとの進捗を表示（例: 5/10項目完了）

### 4. 漏れチェック機能
- 画面下部の「漏れチェック」ボタンをタップ
- 未チェック項目を赤字で強調表示
- 折りたたまれている場合は親項目（セクション名）も赤字

### 5. ビフォー/アフター写真
- 各撮影箇所で「ビフォー」「アフター」を明確に分離
- タップで撮影、即座にアップロード
- 撮影済み写真をサムネイル表示

### 6. デフォルトチェックリスト一括登録
- 約70項目のチェックリスト項目をワンクリックで登録
- 撮影箇所10箇所を自動設定

---

## 🚀 セットアップ手順

### ステップ1: 新しいGASプロジェクトを作成

1. Google Driveを開く
2. 「新規」→「その他」→「Google Apps Script」
3. プロジェクト名を「清掃チェックリスト」に変更

### ステップ2: コードをコピー

1. **ChecklistApp.gs の内容をコピー**
   - GASエディタの `Code.gs` に `ChecklistApp.gs` の全内容をペースト

2. **checklist.html を追加**
   - 「+」→「HTML」→ファイル名を `checklist` に変更
   - `checklist.html` の内容をペースト

### ステップ3: Webアプリとしてデプロイ

1. GASエディタで「デプロイ」→「新しいデプロイ」
2. 「種類の選択」→「ウェブアプリ」
3. 設定：
   - **説明**: 清掃チェックリストv1
   - **次のユーザーとして実行**: 自分
   - **アクセスできるユーザー**: 全員
4. 「デプロイ」をクリック
5. **WebアプリのURLをコピー**（後で使用）

### ステップ4: 予約管理スプレッドシートのIDを設定

1. 予約管理スプレッドシートを開く
2. URLから `spreadsheetId` をコピー
   ```
   https://docs.google.com/spreadsheets/d/【このID部分】/edit
   ```
3. GASエディタで「プロジェクトの設定」→「スクリプト プロパティ」
4. プロパティを追加：
   - **プロパティ**: `BOOKING_SS_ID`
   - **値**: コピーしたスプレッドシートID

### ステップ5: デフォルトチェックリストを登録

1. GASエディタで `ChecklistApp.gs` を開く
2. 関数 `importDefaultChecklist` を選択
3. 「実行」をクリック
4. 権限を許可
5. 実行ログで「成功」を確認

---

## 📲 使い方

### スタッフ向け

#### 1. チェックリストにアクセス

URLに日付パラメータを追加してアクセス：
```
https://script.google.com/macros/s/【デプロイID】/exec?date=2024-12-25&staff=田中
```

- `date`: チェックアウト日（YYYY-MM-DD形式）
- `staff`: スタッフ名

#### 2. 清掃作業の流れ

1. **次回予約詳細を確認**
   - 冒頭に次回予約情報が表示される
   - 人数やBBQ利用などを確認

2. **チェック項目を実行**
   - 部屋ごとのセクションをタップして展開
   - 各項目を実行したらチェックボックスをタップ
   - 要補充が必要な項目は「要補充」にチェック

3. **写真を撮影**
   - 撮影セクションで「ビフォー写真を撮影」をタップ
   - 清掃後は「アフター写真を撮影」をタップ

4. **漏れチェック**
   - 画面下部の「漏れチェック」ボタンをタップ
   - 未チェック項目が赤字で表示される
   - 折りたたまれているセクションも赤字になる

5. **清掃完了**
   - すべての項目をチェック
   - 「清掃完了」ボタンをタップ
   - オーナーに自動で完了通知が送信される

---

## 🔗 予約管理アプリとの連携（次のステップ）

予約管理アプリのカレンダーから直接チェックリストへ飛べるようにするには、
Code.gs の該当部分に以下のコードを追加します：

```javascript
// カレンダーのイベントクリック時
var checklistUrl = 'https://script.google.com/macros/s/【デプロイID】/exec';
var url = checklistUrl + '?date=' + checkoutDate + '&staff=' + staffName;
window.open(url);
```

---

## ⚙️ カスタマイズ

### チェックリスト項目を追加・編集

1. 清掃チェックリスト管理スプレッドシートを開く
   - GASエディタの実行ログ、またはGoogle Driveで検索
2. 「チェックリストマスタ」シートで項目を編集：
   - **ID**: 一意のID（例: item_001）
   - **カテゴリ**: 部屋名や場所（例: キッチン）
   - **項目名**: チェック項目の名前
   - **表示順**: 表示順序（数字）
   - **有効**: Y（有効）/N（無効）
   - **要補充対象**: Y（要補充チェックボックスを表示）/N

### 撮影箇所を追加・編集

1. 「撮影箇所マスタ」シートで編集：
   - **ID**: 一意のID（例: spot_001）
   - **箇所名**: 撮影箇所の名前
   - **撮影タイミング**: ビフォー/アフター/ビフォー/アフター
   - **表示順**: 表示順序
   - **カテゴリ**: グループ名

---

## 📊 データ構造

### スプレッドシート構成

清掃チェックリスト管理スプレッドシート（自動作成）：
- **チェックリストマスタ**: チェック項目の定義
- **撮影箇所マスタ**: 撮影箇所の定義
- **チェックリスト記録**: 各日付のチェック状況
- **チェックリスト写真**: 各日付の写真
- **チェックリストメモ**: 各日付のメモ
- **要補充記録**: 各日付の要補充項目

### 写真の保存先

Google Driveに「清掃チェックリスト写真」フォルダが自動作成され、
すべての写真がここに保存されます。

---

## 🐛 トラブルシューティング

### Q: 次回予約情報が表示されない

**A**: チェックアウト日が正しいか確認してください。
フォーム回答シートのチェックアウト列と一致する必要があります。

### Q: 写真がアップロードできない

**A**: 以下を確認：
1. Google Driveの容量は十分か？
2. スクリプトの権限は許可されているか？
3. ファイルサイズが大きすぎないか？（推奨: 5MB以下）

### Q: チェックリスト項目が表示されない

**A**: `importDefaultChecklist` 関数を実行して、
デフォルト項目を登録してください。

---

## 📝 今後の拡張案

- [ ] オフライン対応（Service Workerで一時保存）
- [ ] 写真の圧縮機能
- [ ] チェックリストのテンプレート切り替え
- [ ] 清掃時間の記録
- [ ] スタッフ別の完了統計

---

## 📞 サポート

問題が発生した場合は、以下を確認してください：

1. GASエディタの実行ログ
2. ブラウザのコンソールログ（F12キーで開く）
3. スクリプト プロパティの設定

詳しくは開発者にお問い合わせください。
