# 清掃チェックリストWebアプリ - 詳細デプロイガイド

## 📋 目次
1. [事前準備](#事前準備)
2. [GASプロジェクト作成とコード配置](#gasプロジェクト作成とコード配置)
3. [Webアプリのデプロイ](#webアプリのデプロイ)
4. [予約管理スプレッドシートとの連携設定](#予約管理スプレッドシートとの連携設定)
5. [デフォルトチェックリストの一括登録](#デフォルトチェックリストの一括登録)
6. [動作確認](#動作確認)
7. [トラブルシューティング](#トラブルシューティング)

---

## 事前準備

### 必要なもの
- [ ] Googleアカウント
- [ ] 予約管理スプレッドシートのURL
- [ ] オーナーのGmailアドレス

### 所要時間
- 初回セットアップ: 約15分
- デフォルトチェックリスト登録: 約2分

---

## GASプロジェクト作成とコード配置

### ステップ1: 新しいGASプロジェクトを作成

1. **Google Driveを開く**
   ```
   https://drive.google.com/
   ```

2. **新規プロジェクトを作成**
   - 左上の「新規」をクリック
   - 「その他」→「Google Apps Script」を選択

3. **プロジェクト名を変更**
   - 左上の「無題のプロジェクト」をクリック
   - 「清掃チェックリスト」と入力
   - 「名前を変更」をクリック

### ステップ2: ChecklistApp.gsをコピー

1. **既存のCode.gsの内容を削除**
   - エディタ内のコードをすべて選択（Ctrl+A / Cmd+A）
   - Delete キーで削除

2. **ChecklistApp.gsの内容をコピー**
   - 下記の「ChecklistApp.gs 完全版」セクションから全文をコピー
   - GASエディタに貼り付け（Ctrl+V / Cmd+V）

3. **ファイル名を変更**
   - ファイルタブ（Code.gs）を右クリック
   - 「名前を変更」→「ChecklistApp」と入力

4. **保存**
   - Ctrl+S / Cmd+S で保存
   - または、ディスクアイコンをクリック

### ステップ3: checklist.htmlを追加

1. **新しいHTMLファイルを作成**
   - 左側のファイル一覧の「+」マークをクリック
   - 「HTML」を選択

2. **ファイル名を設定**
   - ダイアログに「checklist」と入力
   - 「OK」をクリック

3. **checklist.htmlの内容をコピー**
   - GitHubまたはローカルの `checklist.html` から全文をコピー
   - 作成したHTMLファイルに貼り付け

4. **保存**
   - Ctrl+S / Cmd+S で保存

---

## Webアプリのデプロイ

### ステップ4: 初回デプロイ

1. **デプロイボタンをクリック**
   - GASエディタ右上の「デプロイ」→「新しいデプロイ」

2. **設定を入力**

   | 項目 | 設定値 |
   |------|--------|
   | 種類の選択 | ⚙️（歯車アイコン）→「ウェブアプリ」を選択 |
   | 説明 | `清掃チェックリスト v1.0` |
   | 次のユーザーとして実行 | **自分（あなたのメールアドレス）** |
   | アクセスできるユーザー | **全員** |

3. **デプロイをクリック**
   - 「デプロイ」ボタンをクリック

4. **権限の承認**（初回のみ）

   a. 「アクセスを承認」をクリック

   b. Googleアカウントを選択

   c. **「このアプリは Google で確認されていません」と表示された場合**：
      - 左下の「詳細」をクリック
      - 「（プロジェクト名）に移動（安全ではないページ）」をクリック
      - （これは自分が作成したアプリなので問題ありません）

   d. 権限を確認して「許可」をクリック
      - Google ドライブのファイル表示、編集、作成、削除
      - Google スプレッドシートのデータの表示と管理
      - メールの送信
      - 外部サービスへの接続

5. **WebアプリURLをコピー**

   デプロイ完了後、以下のような画面が表示されます：

   ```
   ウェブアプリ
   URL: https://script.google.com/macros/s/AKfycbz.../exec
   ```

   - **このURLを必ずコピーして保存**してください
   - メモ帳などに貼り付けておくと便利です

6. **「完了」をクリック**

---

## 予約管理スプレッドシートとの連携設定

### ステップ5: スプレッドシートIDを取得

1. **予約管理スプレッドシートを開く**
   - ブラウザで予約管理スプレッドシートを開く

2. **URLからIDをコピー**

   URLの形式：
   ```
   https://docs.google.com/spreadsheets/d/【ここがスプレッドシートID】/edit#gid=0
   ```

   例：
   ```
   https://docs.google.com/spreadsheets/d/1a2b3c4d5e6f7g8h9i0j/edit#gid=0
                                          ^^^^^^^^^^^^^^^^^^^^
                                          この部分をコピー
   ```

### ステップ6: スクリプトプロパティに設定

1. **GASエディタに戻る**

2. **プロジェクトの設定を開く**
   - 左側のメニューから「⚙️ プロジェクトの設定」をクリック

3. **スクリプト プロパティに追加**
   - 下にスクロールして「スクリプト プロパティ」セクションを見つける
   - 「スクリプト プロパティを追加」をクリック

4. **プロパティを入力**

   | プロパティ | 値 |
   |-----------|-----|
   | `BOOKING_SS_ID` | コピーしたスプレッドシートID |

   - プロパティ欄に `BOOKING_SS_ID` と入力
   - 値欄に コピーしたスプレッドシートID を貼り付け
   - 「スクリプト プロパティを保存」をクリック

---

## デフォルトチェックリストの一括登録

### ステップ7: 一括登録スクリプトを実行

1. **エディタに戻る**
   - 左側のメニューから「<> エディタ」をクリック

2. **関数を選択**
   - エディタ上部のドロップダウンメニュー（「関数を選択」と表示）をクリック
   - `importDefaultChecklist` を選択

3. **実行**
   - 右の「▶ 実行」ボタンをクリック

4. **権限の承認**（初回のみ）
   - 前回と同様に権限を承認

5. **実行ログを確認**
   - 下部の「実行ログ」タブをクリック
   - `{"success":true,"itemCount":XX,"spotCount":10}` のような表示があれば成功

6. **登録されたデータを確認**

   a. Google Driveを開く

   b. 「清掃チェックリスト管理」というスプレッドシートを探す
      - 検索ボックスに「清掃チェックリスト管理」と入力

   c. スプレッドシートを開く

   d. 以下のシートが作成されていることを確認：
      - チェックリストマスタ（チェック項目が登録済み）
      - 撮影箇所マスタ（10箇所の撮影箇所が登録済み）
      - チェックリスト記録（空）
      - チェックリスト写真（空）
      - チェックリストメモ（空）
      - 要補充記録（空）

---

## 動作確認

### ステップ8: テストアクセス

1. **テストURLを作成**

   先ほどコピーしたWebアプリURLに、テスト用のパラメータを追加：

   ```
   https://script.google.com/macros/s/【デプロイID】/exec?date=2024-12-25&staff=テスト太郎
   ```

   - `date`: チェックアウト日（YYYY-MM-DD形式）
   - `staff`: スタッフ名

2. **ブラウザでアクセス**
   - URLをブラウザのアドレスバーに貼り付けてEnter

3. **表示確認**

   以下が表示されれば成功：
   - ヘッダーにチェックアウト日が表示
   - 次回予約詳細（データがあれば表示）
   - チェックリストのセクション（折りたたみ可能）
   - 撮影セクション
   - メモセクション
   - 下部に「漏れチェック」「清掃完了」ボタン

4. **スマホでアクセス**
   - スマホのブラウザで同じURLにアクセス
   - レスポンシブデザインが適用されることを確認

---

## 予約管理アプリからのリンク設定（オプション）

### ステップ9: 予約管理アプリにリンクを追加

予約管理アプリのカレンダーから直接チェックリストに飛べるようにします。

1. **予約管理アプリのCode.gsを開く**

2. **該当箇所を探す**
   - カレンダーの詳細表示部分を探す
   - 検索: `清掃詳細` または `cleaningDetail`

3. **リンクボタンを追加**

   例（index.htmlの該当箇所）:
   ```html
   <button onclick="openChecklistApp('2024-12-25', 'スタッフ名')">
     清掃チェックリストを開く
   </button>
   ```

   JavaScript:
   ```javascript
   function openChecklistApp(checkoutDate, staffName) {
     var url = 'https://script.google.com/macros/s/【デプロイID】/exec';
     url += '?date=' + checkoutDate + '&staff=' + encodeURIComponent(staffName);
     window.open(url, '_blank');
   }
   ```

---

## トラブルシューティング

### Q1: 「このアプリは Google で確認されていません」と表示される

**A**: これは正常です。自分が作成したアプリなので安全です。

**解決方法**:
1. 「詳細」をクリック
2. 「（プロジェクト名）に移動（安全ではないページ）」をクリック
3. 権限を許可

---

### Q2: 次回予約情報が表示されない

**A**: 以下を確認してください。

**チェック項目**:
- [ ] URLのdateパラメータが正しいか（YYYY-MM-DD形式）
- [ ] スクリプトプロパティ `BOOKING_SS_ID` が設定されているか
- [ ] 予約管理スプレッドシートに該当日のチェックアウト予約があるか
- [ ] GASプロジェクトが予約管理スプレッドシートにアクセスできるか

**確認方法**:
1. GASエディタで `getNextBookingDetails` 関数を選択
2. 実行ログでエラーがないか確認

---

### Q3: 写真がアップロードできない

**A**: 以下を確認してください。

**チェック項目**:
- [ ] カメラの権限が許可されているか（ブラウザ設定）
- [ ] Google Driveの容量は十分か
- [ ] 写真のファイルサイズが大きすぎないか（推奨: 5MB以下）

**解決方法**:
- ブラウザのカメラ権限を確認
- Google Driveの容量を確認
- 写真を圧縮してから撮影

---

### Q4: チェックリスト項目が表示されない

**A**: デフォルトチェックリストが登録されていない可能性があります。

**解決方法**:
1. GASエディタで `importDefaultChecklist` 関数を実行
2. 実行ログで成功メッセージを確認
3. 「清掃チェックリスト管理」スプレッドシートを確認

---

### Q5: デプロイ後にコードを変更したが反映されない

**A**: 新しいデプロイが必要です。

**解決方法**:
1. 「デプロイ」→「デプロイを管理」
2. 既存のデプロイの右の「✏️」（編集）をクリック
3. 右上の「バージョン」で「新バージョン」を選択
4. 「デプロイ」をクリック

---

## バッチ処理用スクリプト

### 複数のチェックリストを一括作成（今後の機能）

```javascript
function createMultipleChecklists() {
  var dates = [
    '2024-12-25',
    '2024-12-26',
    '2024-12-27'
  ];

  dates.forEach(function(date) {
    // 各日付のチェックリストを初期化
    Logger.log('チェックリスト作成: ' + date);
  });
}
```

---

## 📱 スタッフ向け使い方（簡単版）

スタッフに共有する手順：

1. **URLをブックマーク**
   ```
   https://script.google.com/macros/s/【デプロイID】/exec?date=日付&staff=名前
   ```

2. **日付と名前を変更してアクセス**
   - `date`: チェックアウト日（YYYY-MM-DD）
   - `staff`: あなたの名前

3. **清掃作業**
   - 項目をタップしてチェック
   - 写真を撮影
   - 要補充があればチェック
   - メモを追加

4. **完了**
   - 「漏れチェック」で確認
   - 「清掃完了」をタップ

---

## 📊 オーナー向け管理画面

### 要補充リストの確認

1. 「清掃チェックリスト管理」スプレッドシートを開く
2. 「要補充記録」シートを確認
3. フィルターや並べ替えで分析

### 清掃完了通知

清掃完了ボタンが押されると、自動でメールが送信されます：
- 件名: 【民泊】清掃完了報告 - チェックアウト日
- 本文: 清掃担当、完了時刻、要補充リスト

---

## 🔧 カスタマイズ

### チェックリスト項目を追加

1. 「清掃チェックリスト管理」スプレッドシートを開く
2. 「チェックリストマスタ」シートに行を追加
3. 必要な情報を入力

### 撮影箇所を追加

1. 「撮影箇所マスタ」シートに行を追加
2. 必要な情報を入力

---

これで清掃チェックリストWebアプリの完全なセットアップが完了しました！
