# [プロジェクト名] - 開発引き継ぎ資料（CLAUDE.md テンプレート）

> **使い方**: このテンプレートをプロジェクトのルートに `CLAUDE.md` としてコピーし、
> `[...]` のプレースホルダーを実際の値に置き換えてください。
> 不要なセクションは削除し、プロジェクト固有のセクションを追加してください。

---

## ★最重要ルール①: デバッグファースト（推測で修正しない）
**エラーや不具合が報告された場合、原因を推測していきなり修正コードを書いてはならない。**
**これはこのプロジェクトで最も重要なルールである。いかなる場合も例外なく守ること。**
必ず以下の手順を踏むこと：

1. **まずデバッグコードを追加** — 問題箇所の入力値・中間値・出力値をログ出力やデバッグ表示に追加する
2. **デプロイしてユーザーに確認依頼** — デバッグ情報を見てもらい、本当の原因を特定する
3. **原因が判明してから修正** — ログで裏付けが取れた原因に対してのみ修正コードを書く

**やってはいけないこと：**
- 「おそらくこれが原因だろう」で修正コードを書くこと
- デバッグなしで複数箇所を同時に変更すること（どの変更が効いたか分からなくなる）
- 原因不明のまま「念のため」の修正を重ねること
- **デバッグ表示を勝手に削除すること** — 修正が完全に動作確認できた後、ユーザーに削除を提案し、許可を得てから削除する

## ★最重要ルール②: コミット10回で新チャット移行を提案
**コード変更のコミットが10回に達したら、ユーザーに聞かれなくても自主的に新チャットへの移行を提案すること。**
**コミット数は常にカウントし、10回目のコミット完了時点で即座に移行を提案する。**
詳細は「チャット移行時の必須ルール > ルール2」を参照。

## 必須ルール: 修正後のデプロイコマンド出力
**コード修正をコミット＆プッシュした後は、必ず以下の形式でデプロイコマンドを出力すること。**
ユーザーのターミナルにコピペしてすぐデプロイできるようにする。

```
[デプロイコマンドをここに記載]
```

<!-- 例:
```
cd /path/to/project && git fetch origin && git checkout -f <ブランチ名> && git reset --hard origin/<ブランチ名> && npm run deploy
```
-->

- `<ブランチ名>` は現在の作業ブランチ名に置き換える
- 修正の説明の最後に必ずこのコマンドブロックを出力する
- ユーザーが「デプロイして」と言わなくても、コード変更をプッシュしたら毎回出す

## 必須ルール: バージョンバッジの更新
**コード修正をコミットするたびに、バージョン表記を更新すること。**
- バッジ位置: [バージョン表示箇所を記載。例: `index.html` 内の `id="deployVersion"` 要素]
- 命名規則: `vMMDDx`（MM=月, DD=日, x=a,b,c,...のアルファベット連番）
- 同じ日の最初のコミットは `a` から開始（例: `v0301a`）、以降 `b`, `c`, ... とインクリメント
- コミットメッセージにもバージョンを含める（例: `fix: v0301d 〇〇を修正`）

## 必須ルール: 修正履歴の記録
**コード修正をコミットするたびに、このCLAUDE.mdに修正履歴を追記すること。**
- 日付セクション（`## YYYY-MM-DD 修正内容`）に何を変更したか簡潔に記録
- 既知の注意点や仕様変更があれば該当セクションも更新
- 「次回やること」も状況に応じて更新

---

## プロジェクト概要
[プロジェクトの概要を1〜2文で記載]

## アーキテクチャ
- **バックエンド**: [言語/フレームワーク、DB]
- **フロントエンド**: [言語/フレームワーク、UIライブラリ]
- **通信**: [API方式: REST / GraphQL / google.script.run 等]
- **デプロイ**: [デプロイ方法・環境]
- **認証**: [認証方式があれば記載]

## 主要ファイル構成
| ファイル | 行数（目安） | 役割 |
|----------|-------------|------|
| [ファイルパス] | ~[N]行 | [役割の説明] |

<!-- ディレクトリツリー（必要に応じて） -->
```
project-root/
├── src/
│   ├── ...
├── ...
└── CLAUDE.md
```

## データ構造
<!-- DB テーブル / スプレッドシート / コレクション等 -->
| テーブル/シート名 | 用途 |
|---|---|
| [名前] | [用途] |

## 重要な関数・エンドポイント

### [カテゴリ名: 例「データ取得」]
- `[関数名/エンドポイント]` - [説明]

### [カテゴリ名: 例「データ更新」]
- `[関数名/エンドポイント]` - [説明]

## 既知の注意点
<!-- プロジェクト固有の罠・制約・ワークアラウンドを記載 -->

### [注意点タイトル]
[詳細説明。何が問題で、どう対処すべきか]

## 技術的な制約
<!-- フレームワークや環境固有の制約 -->

### [制約タイトル]
[制約の説明と回避策]

## よくある問題と対処法
| 問題 | 原因 | 対処 |
|------|------|------|
| [問題] | [原因] | [対処法] |

---

## 現在のセッション状態
- **ブランチ**: `[ブランチ名]`
- **最新コミット**: `[コミットハッシュ]`
- **進行中タスク**: [タスク内容]
- **デプロイ待ち**: あり/なし（[バージョン]）
- **デバッグコード残存**: [残存箇所の説明、またはなし]

## 次回やること（優先度順）
1. **[高]** [タスク説明]
2. **[中]** [タスク説明]
3. **[低]** [タスク説明]

## YYYY-MM-DD（セッションN）修正内容
1. **[修正概要]**: [詳細説明]

## YYYY-MM-DD（セッションN）コミット履歴
| コミット | 内容 |
|---|---|
| `[ハッシュ]` | [コミットメッセージ] |

### 変更ファイルと箇所（セッションN）
- **[ファイル名]**: [変更箇所の説明]

---

## チャット移行時の必須ルール

### ルール1: 変更プッシュ後は毎回デプロイ手順を表示すること
上記「必須ルール: 修正後のデプロイコマンド出力」に記載のとおり。

### ルール2: 以下の条件を満たしたら新チャットへ移行を**自主的に**提案すること

**ユーザーに聞かれなくても、以下のいずれかに該当したら自分から引き継ぎ資料を更新して新チャットへの移行を提案する。コミット数は常にカウントしておくこと：**

1. **コンテキスト圧縮が発生した場合** — システムから会話の圧縮通知が出たら即座に移行提案
2. **大きな機能・バグ修正が一段落した場合** — デプロイ＋動作確認が完了したタイミング
3. **コード変更のコミットが10回に達した場合** — 10回目のコミット完了時点で即座に移行を提案する（ユーザーの指示を待たない）
4. **デバッグ→修正のサイクルが3回以上繰り返された場合** — コンテキストが散漫になるため

移行を提案する際は以下の2点を必ずセットで出力する：
1. 移行の声かけ：「そろそろコンテキストが大きくなってきたので、引き継ぎ資料を更新して新しいチャットに移行しませんか？」
2. **新チャットへ貼り付ける最初のプロンプト**をコードブロックで出力する（ユーザーがそのままコピペできる形式）

新チャット用プロンプトのテンプレート：
```
CLAUDE.mdを読んで引き継ぎ内容を確認してください。
ブランチ: <現在のブランチ名>
前回の最終コミット: <最新コミットハッシュ>

前回の作業サマリー:
- <完了した主な作業を箇条書き>

今回やりたいこと:
- <次回やることリストから、または新しいタスク>
```

### ルール3: 常に日本語で応答すること

### ルール4: 新チャット移行時にこの必須ルールを必ず引き継ぐこと
CLAUDE.mdのルールセクション全体を次のセッションでも参照できる状態にすること。

### ルール5: 新チャットは引き継ぎ確認→質問→回答待ち→作業開始の順を守ること

**ステップ1: 引き継ぎ資料を読む**
- CLAUDE.mdを読んで内容を確認する
- `git fetch origin <作業ブランチ>` + `git log origin/<作業ブランチ> --oneline -10` でコードの状態を確認

**ステップ2: 疑問点を洗い出し、前のチャットへの質問プロンプトを作成**

引き継ぎ資料を読んだ後、不明点や確認事項があれば、以下のような形式で**前のチャットに貼り付けるための質問プロンプト**を作成する。**ユーザーがそのままコピペできる形式**にすること：

```
前のチャットで以下を確認してください：

1. 「〇〇の実装」について、△△の部分はこの理解で合っていますか？
2. □□の機能は完了していますか？テスト済みですか？
3. ××のエラーが出ていましたが、解決済みですか？
4. この部分を変更しても他に影響はありませんか？
```

ユーザーはこのプロンプトをコピーして前のチャットに貼り付け、回答を得てから新チャットに戻る。

**ステップ3: ユーザーの返答を待つ**

質問プロンプトを出した場合は、**ユーザーからの返答を待ってから**開発を開始する。
質問がない場合はその旨を伝え、すぐに開発を開始してOK。

### チャット移行の具体的手順

#### 旧チャット側（移行前）がやること
1. 作業中のコードをすべてコミット＆プッシュ
2. CLAUDE.mdを以下の内容で更新：
   - 「現在のセッション状態」を最新化（ブランチ名・最新コミットハッシュ・進行中タスク）
   - 日付別修正内容＋コミット履歴テーブルを追記
   - 「次回やること」を更新
   - **ルール6の必須5項目を必ず含めること**
3. 更新をコミット＆プッシュ

#### 新チャット側がやること
→ ルール5の手順に従う（引き継ぎ確認→質問プロンプト作成→返答待ち→作業開始）

### ルール6: 引き継ぎ資料に以下の5項目を必ず含めること
1. **現在取り組んでいるタスク・機能の説明** — 「現在のセッション状態」セクション
2. **完了した作業と未完了の作業** — 日付別修正内容 + 「次回やること」
3. **既知のバグや注意点** — 「既知の注意点」セクション
4. **次のセッションでやるべきこと** — 「次回やること（優先度順）」
5. **コードの変更箇所のサマリー（コミットハッシュ付き）** — 日付別コミット履歴テーブル

### ルール7: 新チャットでやってはいけないこと

1. **新しいブランチを作らない** — 引き継ぎプロンプトに記載されたブランチをそのまま `git checkout` して使う
2. **この環境でデプロイを実行しない** — デプロイはユーザーのローカル環境で実行する。コード修正後はデプロイコマンドを出力するだけでよい
3. **npm install を実行しない** — 依存関係は既にインストール済み。不要な lock ファイル変更を防ぐ
4. **PRを勝手に作成しない** — ユーザーから指示がない限り、PRは作成しない

### ルール8: 新規プロジェクトではCLAUDE-TEMPLATE.mdをコピーして使用すること

**CLAUDE.mdが存在しないプロジェクトで新しくチャットを開始する場合：**

1. リポジトリに `CLAUDE-TEMPLATE.md` があるか確認する
2. ある場合は `CLAUDE-TEMPLATE.md` を `CLAUDE.md` にコピーし、プレースホルダーをプロジェクトに合わせて埋める
3. ない場合はユーザーに「CLAUDE-TEMPLATE.mdが見つかりません。テンプレートの場所を教えてください」と確認する
4. プロジェクト概要・アーキテクチャ・ファイル構成・デプロイコマンド等はコードベースを読んで自動的に埋める
5. 埋めた内容をユーザーに確認してもらってからコミットする
