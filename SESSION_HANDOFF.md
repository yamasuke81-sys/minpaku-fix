# セッション引き継ぎファイル

> **最終更新**: 2026-02-13
> **作業ブランチ**: `claude/create-handoff-docs-tRAuI`
> **最新コミット**: `c13137f 大カテゴリと中カテゴリの見出しデザインを差別化`

---

## 必須ルール（全セッション共通・厳守）

### ルール1: 変更プッシュ後は毎回デプロイ手順を表示すること

コードを変更してプッシュしたら、**必ず毎回**以下のデプロイコマンドを表示する。
ブランチ名は、**現在の作業ブランチに合わせて随時書き換えること**。
チェックアプリ（`checklist-app/`）に変更がある場合も `deploy-all.js` で両方デプロイされるので同じコマンドでOK。

```
cd C:\Users\yamas\minpaku-fix && git pull origin <現在の作業ブランチ> && node deploy-all.js
```

**現時点のコマンド:**
```
cd C:\Users\yamas\minpaku-fix && git pull origin claude/create-handoff-docs-tRAuI && node deploy-all.js
```

### ルール2: チャット行数が5000行を超えたら移行を提案すること

チャットの行数が **5000行を超えた時点** で、次のチャットへの移行をユーザーに提案する。
移行時には以下を実行：
1. `SESSION_HANDOFF.md` を最新状態に更新（完了作業・未完了事項・コミット履歴）
2. `HANDOFF.md` も必要に応じて更新
3. コミット＆プッシュ

### ルール3: 常に日本語で応答すること

---

## チャット移行の手順

### 旧チャット側（移行前）がやること

1. 作業中のコードをすべてコミット＆プッシュ
2. `SESSION_HANDOFF.md` を以下の内容で更新：
   - 完了した作業の一覧
   - 未完了・作業中のタスク
   - 最新コミットハッシュとブランチ名
   - 注意点・ハマったポイント
3. `HANDOFF.md` のコミット履歴・完了作業セクションを最新化
4. 更新をコミット＆プッシュ

### 新チャット側がやること

**ステップ1: 引き継ぎ資料を読む**
```
SESSION_HANDOFF.md を読んでください
HANDOFF.md を読んでください
```

**ステップ2: ブランチとコードの状態を確認**
```
git fetch origin <作業ブランチ>
git log origin/<作業ブランチ> --oneline -10
```

**ステップ3: 疑問点を洗い出し、前のチャットへの質問プロンプトを作成**

引き継ぎ資料を読んだ後、不明点や確認事項があれば、以下のような形式で **前のチャットに貼り付けるための質問プロンプト** を書き出す：

```
前のチャットで以下を確認してください：

1. 「〇〇の実装」について、△△の部分はこの理解で合っていますか？
2. □□の機能は完了していますか？テスト済みですか？
3. ××のエラーが出ていましたが、解決済みですか？
4. この部分を変更しても他に影響はありませんか？
```

ユーザーはこのプロンプトをコピーして前のチャットに貼り付け、回答を得てから新チャットに戻って開発を継続する。

**ステップ4: 開発を開始**

疑問が解消されたら、通常の開発作業を開始する。

---

## 必須デプロイコマンド（ユーザーのWindows PCで実行）

```
cd C:\Users\yamas\minpaku-fix && git pull origin claude/create-handoff-docs-tRAuI && node deploy-all.js
```

**注意**:
- コードの変更後は必ず上記を実行しないとGASに反映されない
- `deploy-all.js` はメインアプリ + チェックリストアプリの両方をデプロイする
- ブランチ名は作業ブランチに合わせて更新すること

---

## 今回のセッションで完了した作業

### 1. 大カテゴリと中カテゴリの見出しデザイン差別化
- **大カテゴリ**: 濃紺背景（`#2c3e50`）＋白文字＋白アイコン → 目立つ帯状デザイン
- **中カテゴリ**: 薄い青背景（`#eaf2fb`）＋青アイコン（`#3498db`）→ 軽めのデザイン
- **小カテゴリ**: オレンジアイコン（`#e67e22`）を明示的に設定
- **細カテゴリ**: 紫アイコン（`#9b59b6`）を明示的に設定
- 大カテゴリの「全チェック」ボタンも白系に調整
- 未完了時の大カテゴリは赤背景（`#c0392b`）

### 2. 引き継ぎ資料の整備
- チャット移行ルール（5000行超で移行提案）を策定
- デプロイコマンド毎回表示ルールを明文化
- 新チャット側での質問プロンプト作成フローを策定

### 3. 前セッションまでの完了作業
- チェックリストUI改善（サムネイル3倍化、ボタン右寄せ、項目削除、状態維持）
- チェックリスト4階層対応（大：中：小：細）+ CSV全558項目
- タブナビ移動、漏れチェック統合、メモ自動保存、項目名タッチ対応
- 見本写真サムネイル表示、撮影箇所レイアウト整備
- カテゴリ階層ボタン追加、追加ボタン控えめデザイン

---

## 未完了・要確認事項

### スプレッドシートのデータ問題（コード修正不要）
- **2/23 日付の黄色背景が消えない**: 「募集」シートに2/23の行が「募集中」のまま残っている → 該当行を削除 or ステータス変更
- **「西山PCテスト」の▲表示**: 「募集_立候補」シートに回答データ（△）が残存 → 該当行を削除

### デプロイ後の確認必要
- 大カテゴリ・中カテゴリの見出しデザイン差別化が実機で正しく表示されるか
- 558項目の4階層チェックリストが正しく表示されるか
- 折りたたみの開閉、全チェック、項目追加/削除が正常動作するか

### 将来の課題（HANDOFF.mdにも記載）
- 条件分岐対応（BBQ利用あり/なし、宿泊人数による表示切替）
- 在庫管理リスト機能
- リネン洗濯フロー管理

---

## 主要ファイル構成

| ファイル | 行数（概算） | 役割 |
|----------|-------------|------|
| `Code.gs` | ~6700行 | メインアプリ（予約管理）サーバー |
| `index.html` | ~6000行 | メインアプリ フロントエンド |
| `checklist-app/Code.gs` | ~1700行 | チェックリストアプリ サーバー |
| `checklist-app/checklist.html` | ~2300行 | チェックリストアプリ フロントエンド |
| `checklist-app/cleaning_checklist.csv` | 759行 | チェックリスト元データ（Notionからエクスポート） |
| `deploy-all.js` | 166行 | 一括デプロイスクリプト |
| `HANDOFF.md` | ~390行 | プロジェクト全体の技術資料 |

---

## 技術的な注意点

### カテゴリの区切り文字
- 全角コロン `：`（U+FF1A）を使用
- 例: `テラス：次の予約がBBQ利用あり：↓セット内容↓`

### レンダリングの仕組み
- `buildCategoryTree()` が全アイテムをツリー構造に変換
- `renderCategoryNode()` が再帰的にHTMLを生成
- レベル0=`.section`（濃紺）、1=`.sub-section`（薄青）、2=`.sub-sub-section`（オレンジ）、3=`.sub-sub-sub-section`（紫）

### データ保存
- GASのSpreadsheetService（Google Sheets）をバックエンドDBとして使用
- チェック状態は日付ごとに管理（シート名: `CL_YYYY-MM-DD`）
- マスターデータ: `CL_マスター`（項目定義）、`CL_撮影箇所`（撮影箇所定義）
